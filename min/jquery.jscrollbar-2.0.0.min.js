/**
 * @fileOverview jquery.jscrollbar
 * @author daiying.zhang
 * @mail   zdying@live.com/97532151@qq.com
 * @site   http://imf2e.com
 * @version 2.0.0
 */
(function(d){function p(a,b,c,g){var f=this.opt,m=this.$con[0],e=this.$node.clone().appendTo("body").width(b).height(c).find(".jscrollbar"),n=f.showXBar&&m.scrollWidth>b,m=f.showYBar&&m.scrollHeight>c,k=0,k="",h="outer"===f.position?g:0;n&&m?k="xy":n?(k=e.css({height:c-h,zIndex:-1})[0].scrollHeight,k="x"+(f.showXBar&&k>c-h?"y":"")):m&&(k=e.css({width:b-h,zIndex:-1})[0].scrollWidth,k=(f.showXBar&&k>b-h?"x":"")+"y");this.scrollWidth=e[0].scrollWidth;this.scrollHeight=e[0].scrollHeight;e.parent().remove();this.bars=k;f=this.delta=(this.bars.length-1)*g;e=this.thumbSize={x:q.call(this,"x"),y:q.call(this,"y")};this.maxPos={x:b-e.x-f,y:c-e.y-f};this.maxSPos={x:this.scrollWidth-b+f,y:this.scrollHeight-c+f};b=this.bars.split("");n=0;for(m=b.length;n<m;n++)c=l[e=b[n]],f=l["xy".replace(e,"")].s,d("<div></div>").addClass(e).data("thumbType",e).css(f,g).append(d(r)[c.s](this.thumbSize[e]).data("type",e)).insertAfter(this.$con.css(f,"-="+("outer"===this.opt.position?g:0)));"inner"===this.opt.position&&a.find(".x,.y").css("background","transparent")}function q(a){a=l[a];return Math.max(20,Math.pow(this.$con[a.s]()-this.delta,2)/this.$con[0][a.ss])}function s(){var a=this;this.$node.on("mousedown",".thumb",function(b){t.call(a,b,b.target);return!1}).on("click",".x,.y",function(b){var c=0,c=b.target,g=d.data(c,"thumbType"),f=l[g];c===this&&(c=b["page"+g.toUpperCase()]-d(c).offset()[f.p],a.scrollTo(g,c/a.maxPos[g]*a.maxSPos[g]))});d(document).unbind("mouseup.jsb").bind("mouseup.jsb",function(){d(this).unbind("mousemove.jsb")});u.call(this);"inner"===this.opt.position&&v.call(this)}function v(){var a=this.$node;a.hover(function(){a.find(".x,.y").stop().animate({opacity:1},200)},function(){a.find(".x,.y").stop().animate({opacity:0},500)}).mouseout()}function u(){var a=this.node,b=this,c=null;this.opt.mouseEvent&&(c=function(a){a=a||window.event;b.scrollBy(2===b.bars.length?"y":b.bars,-(a.wheelDelta?a.wheelDelta/120:-a.detail/3)*b.opt.mouseSpeed);d.event.fix(a).preventDefault()},a.addEventListener?(a.addEventListener("mousewheel",c),a.addEventListener("DOMMouseScroll",c)):a.onmousewheel=c)}function t(a,b){var c={X:a.pageX,Y:a.pageY},g=this,f={X:parseInt(d(b).css("left"))||0,Y:parseInt(d(b).css("top"))||0};d(document).bind("mousemove.jsb",function(a){var e=d.data(b,"type"),h=e.toUpperCase(),k=l[e].p;a=Math.min(Math.max(0,f[h]+(a["page"+h]-c[h])),g.maxPos[e]);d(b).css(k,a);g.scroll(e);return!1})}function h(a,b){this.node=a[0];this.$node=a;this.width=a.width();this.height=a.height();this.opt=b;this.plugID="jsb_"+Math.floor(9E3*Math.random()+1E3);var c=this.width,g=this.height,f=b.width;this.$node.css("overflow","hidden").addClass("jscrollbar").wrapInner(w.attr("id",this.plugID).css({width:c,height:g}));this.$con=d("#"+this.plugID);p.call(this,this.$node,c,g,f);s.call(this)}var w=d('<div class="jscrollbar" style="overflow: hidden"></div>'),r='<div class="thumb"></div>',l={x:{s:"width",p:"left",sp:"scrollLeft",ss:"scrollWidth"},y:{s:"height",p:"top",sp:"scrollTop",ss:"scrollHeight"}};h.fn=h.prototype;h.fn.update=function(a){var b=this.$node,c=this.width=b.width(),g=this.height=b.height(),f=this.opt.width,d=this.getScrollPos("x"),e=this.getScrollPos("y");this.$node.find(".x,.y").remove();this.$con.css({width:c,height:g});p.call(this,b,c,g,f);switch(a){case "relative":d&&this.scrollTo("x",d);e&&this.scrollTo("y",e);break;case "bottom":this.scrollTo("y",this.maxSPos.y);break;case "right":this.scrollTo("x",this.maxSPos.x);break;default:this.scroll()}this.scroll()};h.fn.getThumbLocation=function(a){return parseFloat(this.$node.find("."+a+" .thumb").css(l[a].p))||0};h.fn.getScrollPos=function(a){return this.$con[0][l[a].sp]};h.fn.scroll=function(a){void 0===a&&(a="x",this.scroll("y"));this.$con[0][l[a].sp]=this.getThumbLocation(a)/this.maxPos[a]*this.maxSPos[a]};h.fn.scrollBy=function(a,b){this.scrollTo(a,this.$con[0][l[a].sp]+b)};h.fn.scrollTo=function(a,b){b=Math.max(Math.min(this.maxSPos[a],b),0);this.$con[0][l[a].sp]=b;this.$node.trigger("scroll",[a,b]);var c=l[a],d=this.maxPos[a]*(b||this.$con[0][c.sp])/this.maxSPos[a];this.$node.find("."+a+" .thumb").css(c.p,d)};d.fn.jscrollbar=function(a){if("string"===typeof a){var b=this.data("jsb_data");return b?b[a].apply(b,[].slice.call(arguments,1)):this}a=d.extend({},{width:8,position:"inner",showXBar:!0,showYBar:!0,mouseEvent:!0,mouseSpeed:30},a);return this.each(function(){d.data(this,"jsb_data")||d.data(this,"jsb_data",new h(d(this),a))})};d.fn.jscrollbar.version="2.0.0"})(jQuery);